@model qTech_custom_grid.ViewModels.UserSearchViewModel

@{
    ViewData["Title"] = "إدارة المستخدمين";
}

@* Add anti-forgery token for AJAX requests *@
@Html.AntiForgeryToken()

<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="text-primary">
                <i class="fas fa-users"></i> إدارة المستخدمين
            </h2>
            <hr />
        </div>
    </div>

    <!-- Search and Action Bar -->
    <div class="row mb-3">
        <div class="col-md-8">
            <div class="row">
                <div class="col-md-4">
                    <div class="input-group">
                        <input type="text" class="form-control" id="txt_PhoneSearch" placeholder="البحث برقم الجوال..." />
                        <span class="input-group-text"><i class="fas fa-phone"></i></span>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="input-group">
                        <input type="text" class="form-control" id="txt_IdSearch" placeholder="البحث برقم الهوية..." />
                        <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="btn-group w-100" role="group">
                        <button class="btn btn-outline-primary" type="button" id="btn_Search">
                            <i class="fas fa-search"></i> بحث
                        </button>
                        <button class="btn btn-outline-secondary" type="button" id="btn_ClearSearch">
                            <i class="fas fa-times"></i> مسح
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4 text-start">
            <!-- Action Buttons -->
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-success" id="btn_Add">
                    <i class="fas fa-plus"></i> إضافة
                </button>
                <button type="button" class="btn btn-primary" id="btn_View" disabled>
                    <i class="fas fa-eye"></i> عرض
                </button>
                <button type="button" class="btn btn-danger" id="btn_Delete" disabled>
                    <i class="fas fa-trash"></i> حذف
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="div_Loader" class="text-center" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">جاري التحميل...</span>
        </div>
        <p>جاري تحميل البيانات...</p>
    </div>

    <!-- Users Grid using mGrid -->
    <div class="row">
        <div class="col-12">
            <table id="tbl_Users" class="table table-striped table-hover" style="display: none;">
                <!-- Grid will be generated by mGrid -->
                <!-- Pagination will be integrated as table caption by mGrid -->
            </table>
        </div>
    </div>

    <!-- Empty Data Message -->
    <div id="div_Empty" class="text-center py-4" style="display: none;">
        <i class="fas fa-users fa-3x text-muted mb-3"></i>
        <h5 class="text-muted">لا توجد بيانات للعرض</h5>
        <p class="text-muted">لم يتم العثور على مستخدمين مطابقين لمعايير البحث</p>
    </div>

    <!-- Hidden Pager Container (for mGrid compatibility) -->
    <div id="div_Pager" style="display: none;">
        <!-- This div exists only for mGrid compatibility, actual pagination will be in table caption -->
    </div>
</div>

<!-- User Modal Container -->
<div id="userModalContainer">
    <!-- Modals will be loaded here via AJAX -->
</div>

<!-- Tooltip for grid -->
<div id="div_title" style="display: none;"></div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">تأكيد العملية</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
            </div>
            <div class="modal-body" id="confirmationModalBody">
                <!-- Confirmation message will be set here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                <button type="button" class="btn btn-danger" id="confirmActionBtn">موافق</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Include existing validation and grid scripts -->
    <script src="~/js/mScript.js"></script>
    <script src="~/js/mValidation.js"></script>
    <script src="~/js/mSingleCheck.js"></script>
    <script src="~/js/mGrid-1.0.js"></script>
    <!-- Include consolidated user management script -->
    <script src="~/js/userManagement.js"></script>
}
